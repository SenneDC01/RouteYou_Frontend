Skip to content
GitLab
5
Help
Arne Hebbrecht
2
2324_ATP_routeyou_1_Frontend
Project information
Repository
Issues37
Merge requests0
CI/CD
Security and Compliance
Deployments
Packages and registries
Infrastructure
Monitor
Analytics
Wiki
Snippets
Settings
ikdoeictikdoeict

2324_ATP_routeyou_1
2324_ATP_routeyou_1_Frontend
Repository

Update .gitlab-ci.yml file
Arne Hebbrecht authored 1 day ago
2c03f7c4
 Code owners
Assign users and groups as approvers for specific file changes. Learn more.
2324_atp_routeyou_1_frontend
.gitlab-ci.yml
.gitlab-ci.yml
1.48 KiB
default:
  image: ubuntu
  tags:
    - docker-runner-frontend
stages:
  - buildSite
  - buildImage
  - pushImage 
build_site:
  stage: buildSite
  image: $NODE_IMAGE
  script:
    - ls -al
    - npm install
    - npm run build 
    - ls -al
  artifacts: 
    paths:
      - ".next"
buildImage:
  stage: buildImage
  image: docker:24.0.7
  services:
    - docker:dind  # Use the Docker-in-Docker service to access the Docker socket
  script:
    - docker --version
    - echo "FROM nginx:latest" > Dockerfile
    - echo "COPY ./.next /usr/share/nginx/html" >> Dockerfile
    - echo "RUN rm /etc/nginx/conf.d/default.conf" >> Dockerfile
    - echo "COPY custom.conf /etc/nginx/conf.d/default.conf" >> Dockerfile
    - cat Dockerfile
    - docker build -t dev-frontend-image .
    - docker save -o dev-frontend-image.tar dev-frontend-image
  artifacts:
    paths:
    - dev-frontend-image.tar  
pushImage:
  stage: pushImage
  image: google/cloud-sdk
  script:
    - touch gcloud-service-key.json
    - echo "$GCLOUD_SERVICE_KEY" > gcloud-service-key.json
    - cat gcloud-service-key.json
    - gcloud auth activate-service-account --key-file=gcloud-service-key.json
    - gcloud auth configure-docker europe-west1-docker.pkg.dev
    # Load the Docker image from the tarball
    - docker load -i dev-frontend-image.tar
    # Push the Docker image to the specified repository
    -  docker tag dev-frontend-image:latest $FRONTEND_REPO
    - docker push $FRONTEND_REPO
    
    
    
    
71
72
73
74
75
76
77
    




